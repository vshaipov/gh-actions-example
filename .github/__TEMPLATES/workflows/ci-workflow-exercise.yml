## This workflow shows how to use conditional executions on context
##
## Exercise Goal:
## The workflow below contains intentional mistakes or missing logic.
## Your task is to fix it so that:
##
## âœ… Jobs run only on the appropriate branches
## âœ… Each job runs in the correct order using 'needs'
## âœ… Conditional logic is used with the correct GitHub context values
## âœ… CVE scanning runs on main, feature/* and bugfix/* branches only
## âœ… Deployment runs ONLY on the main branch, and only after a successful CVE scan

name: CI Workflow Exercise

on:
  push:
    branches:
      - '**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Build
        run: echo "ğŸ› ï¸ Building the project..."

  # â„¹ï¸ Must run after 'build'
  # â„¹ï¸ Should run only for: main, feature/* and bugfix/*
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Run Tests
        run: echo "âœ… Testing on ${{ github.ref }}"

  # â„¹ï¸ Must run after 'build'
  # â„¹ï¸ Should run only for branches starting with 'bugfix/'
  bugfix-check:
    runs-on: ubuntu-latest
    steps:
      - name: Run Bugfix Validation
        run: echo "ğŸ•µï¸ Bugfix validation for ${{ github.ref }}"

  # â„¹ï¸ Must run after 'test'
  # â„¹ï¸ Should run only for: main, feature/* and bugfix/*
  cve-scan:
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'main'  # ğŸ”§ This is incorrect â€” fix it!
    steps:
      - name: CVE Scan
        run: echo "ğŸ›¡ï¸ Scanning dependencies..."

  # â„¹ï¸ Must run only after CVE scan
  # â„¹ï¸ Should run only for the 'main' branch
  deploy:
    runs-on: ubuntu-latest
    needs: [test]
    steps:
      - name: Deploy
        run: echo "ğŸš€ Deploying ${{ github.ref }}"
